CREATE TABLE USERS
(
  USERNAME VARCHAR2(50) NOT NULL, -- id
  PASSWORD VARCHAR2(100) NOT NULL, -- pwd
  ENABLED CHAR(1) DEFAULT '1' NOT NULL, -- status of account
  NAME VARCHAR2(20) NOT NULL,
  BIRTH CHAR(8) NOT NULL,
  GENDER CHAR(3) NOT NULL,
  PHONE VARCHAR2(20) NOT NULL,
  ZIPCODE CHAR(5) NOT NULL,
  ADDR VARCHAR2(150) NOT NULL,
  DETAILADDR VARCHAR2(100) NOT NULL,
  EMAIL VARCHAR2(60) NOT NULL,
  REGDATE DATE DEFAULT SYSDATE NOT NULL,
  AUTHORITY_CODE varchar(20) DEFAULT 'ROLE_USER' NOT NULL
);

/*위의 create문에서 처리됨.*/
ALTER TABLE USERS
Rename column AUTHORITY to AUTHORITY_CODE; 

ALTER TABLE USERS
ADD CONSTRAINT PK_USERS_UNAME PRIMARY KEY(USERNAME);

ALTER TABLE USERS
ADD CONSTRAINT FK_USERS_AUTHORITYCODE FOREIGN KEY(AUTHORITY_CODE) REFERENCES AUTHORITIES(AUTHORITY_CODE);

COMMIT;
/*
ALTER TABLE USERS
DROP CONSTRAINT FK_USERS_AUTHORITYCODE;
*/

select * from USER_INDEXES;


CREATE TABLE MEMBER_AUTHORITY
(
    ID VARCHAR2(50) NOT NULL, -- 로그인 아이디
    AUTHORITY VARCHAR2(50) NOT NULL
);



CREATE TABLE AUTHORITIES
(
    AUTHORITY VARCHAR2(50) NOT NULL,
    AUTHORITY_CODE VARCHAR2(50) NOT NULL
);

--위에서 처리 됨.
ALTER TABLE AUTHORITIES
RENAME COLUMN AUTHORITY_NAME to AUTHORITY_CODE;

ALTER TABLE AUTHORITIES
ADD CONSTRAINT PK_AUTHORITY_AUTHORITYCODE PRIMARY KEY(AUTHORITY_CODE);

ALTER TABLE MEMBER_AUTHORITY
ADD CONSTRAINT FK_MEMBERAUTHORITY_ID FOREIGN KEY(ID) REFERENCES USERS(USERNAME);



INSERT INTO AUTHORITIES(AUTHORITY_CODE, AUTHORITY) VALUES('1', 'ROLE_USER');

INSERT INTO AUTHORITIES(AUTHORITY_CODE, AUTHORITY) VALUES('2', 'ROLE_MANAGER');

INSERT INTO AUTHORITIES(AUTHORITY_CODE, AUTHORITY) VALUES('3', 'ROLE_ADMIN');

INSERT INTO USERS(DETAILADDR,zipcode, enabled, username, password, name, birth, gender, phone, addr, email, authority_code) VALUES('202','11111', '1', 'admin', '1234', '관리자', '111111', '남', '010-000-0000', '서울특별시', 'admin.daen.net', 3);



